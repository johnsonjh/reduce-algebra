<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
    <script>
        // add textarea + button
        window.reduceLatch = 0;
        let ta = document.createElement('textarea');
        ta.cols = 80;
        ta.rows = 10;
        ta.setAttribute('id', 'reduce-input');
        let button = document.createElement('button');
        button.appendChild(document.createTextNode('Submit'));
        button.addEventListener('click', event => {
            // need to convert the string to a Uint8Array
            let str = unescape(encodeURIComponent(ta.value));
            // found the above snippet at https://gist.github.com/emrahgunduz/5c27ff1db650b93c7864
            let buf = new Uint8Array(str.length);
            for (let i=0; i<str.length; i++)
                buf[i] = str.charCodeAt(i);
            worker.postMessage({
                funcName: 'insert_buffer',
                callbackId: '',
                data: buf
            });
        });
        document.addEventListener("DOMContentLoaded", function(event) {
            document.body.appendChild(ta);
            document.body.appendChild(button);
        });
        let worker = new Worker('./reduce.web.js');
        worker.onmessage = function(event) {
            if (event.data.channel === 'stdout') {
                console.log(event.data.line);
            }
        }
    </script>
</head>
<body>
</body>
</html>
